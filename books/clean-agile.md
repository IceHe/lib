# Clean Agile: Back to Basics

> 敏捷整洁知道 : 回归本源

## Snippets

推荐序二

> 当管理者介绍敏捷时, 只强调了敏捷可以让软件成本更低, 交付更快, 质量更高, 但没有强调它需要严格的几率, 这种纪律纪要约束雇员, 也要约束老板.

敏捷宣言第五句

> Craftmanship over Crap
>
> 匠心雕琢高于瞎写垃圾

### 第一章 介绍敏捷

敏捷宣言

- https://agilemanifesto.org
    - **个体和互动** 高于 ~~流程和工具~~
    - **可用的软件** 高于 ~~详尽的文档~~
    - **客户合作** 高于 ~~合同谈判~~
    - **响应变化** 高于 ~~遵循计划~~

> **Manifesto for Agile Software Development**
>
> We are uncovering better ways of developing
> software by doing it and helping others do it.
> Through this work we have come to value:
>
> - **Individuals and interactions** over ~~processes and tools~~
> - **Working software** over ~~comprehensive documentation~~
> - **Customer collaboration** over ~~contract negotiation~~
> - **Responding to change** over ~~following a plan~~
>
> That is, while there is value in the items on
> the right, we value the items on the left more.

( 项目管理的 ) 铁十字

> 质量 (好)、速度 (快)、成本 (低)、完成, 你只能人选 3 个, 没法 4 个全要.
>
> 可以要求高质量、快速、低成本, 这样的话项目就做不完.
> 也可以要求低成本、快速地完成项目.

- _icehe : 感觉 ByteDance 选择放弃 "成本(低)" , 选择高质量、快速地完成项目._
    - _"成本高" 的 "成本" 指的是 "人力成本"_

更好的方式

> 瀑布这个想法最大的问题在于 : 它听上去特别有道理. 我们首先分析问题, 然后设计解决方案, 接着按照设计实现.
>
> 简单. 直接. 明显. 单却是错的.

幻想与管理

> **戳破幻想是敏捷的主要目的之一. 我们实践敏捷, 正是为了在幻想杀死项目之前, 先把幻想摧毁.**
>
> _幻想是项目的杀手. 幻想促使软件团队误导管理人员, 使管理人员无法了解实际进展._ **有人认为 "敏捷" 就等于 "快". 不是的, 它从来就与 "快" 无关. "敏捷" 就是要帮助我们尽早了解我们到底做得有多糟糕.** _我们想尽早知道这一点的原因是我们可以管理这种情况._
>
> _你看, "管理" 是管理者的工作. 管理者通过收集数据来管理软件项目, 然后根据这些数据做出最佳决策. 敏捷产生数据, 产生大量的数据. 管理者们使用这些数据来推动项目达到尽可能好的结果._
>
> "尽可能好的结果" 往往不是最初期望的结果, 它可能会使当初委托该项目的利益相关者感到非常失望. 但是, 按照字面意思, "尽可能好的结果" 就是他们所能获得的最好结果.

### 第二章 敏捷的理由

稳定的生产率

> 随着时间的推移, 混乱开始在代码中积累. 如果代码没有保持干净和有序, 就阻碍团队前行. 杂乱代码越多, 阻碍越大, 进展越慢. 团队进展越慢, 项目日程压力就更大, 这养着带来更多的混乱. 这个正反馈循环可以使团队趋于停滞.

- _icehe : 例如一个人没多久就会 "跳槽" 离开, 那么就容易开始得过且过地工作, 将就生产杂乱的代码, 糊弄式地完成任务…_

> 更糟糕的事, 存量代码是更强大的 "导师" ( 对于新人来说 ) . 新员工将学习旧代码并推测该团队的工作方式, 并继续进行哪些智造杂乱的实践. 因此, 尽管增加了新员工, 但生产率仍继续下降.

划算的适应性

> 软件 software 是一个组合词. "软" soft 的意思是容易修改, "件" ware 的意思是产品. 因此, "软件" software 就是 "容易修改的产品" . 我们之所以发明软件, 就是想要一种快速而且简单的方式来改变机器的行为. 如果希望它的行为很难被改变, 那可能我们就把它起名为 "硬件" hardware 了.
>
> 开发团队经常抱怨需求变更. 我经常能听到类似说法 : "这个需求变更完全不符合我们的架构." 我有一些事情要告诉你, 小伙子 : 如果需求变更破坏了你的软件架构, 那说明你的架构太糟糕了.
>
> 我们开发人员应该歌颂需求变更, 因为这才是我们存在的原因. 软件开发这个游戏的名字就叫 "需求变更". 有了这些变更, 我们的事业和薪水全拜变更所赐. 接受和实现变更, 让变更成本相对划算, 这种能力使我们的工作之本.

- _icehe : 基本同意. 需求变更实属正常, 实际工作中, 俺更多抱怨的是 -- 管理者过分压缩工期, 逼得我不得不加班…_

无畏之力

> 为什么大部分的软件系统不会随着时间的推移而变好? 是因为恐惧, 更具体地说, 因为害怕改变.
>
> 想象你正在电脑屏幕前看着一些旧代码. 你的第一个念头是 : "这段代码写得太差劲了, 我应该清理一下." 但是下一个念头是 : "我不想碰它!" 因为你知道, 如果碰了这段代码, 你会把软件搞坏, 然后这段代码就变成了你的代码. 所以你退缩了, 尽管清理代码有可能对旧代码有所改善.

- _icehe : 如果我改动的代码出了 bug, 那就是我的锅了, 谁也不想做吃力不讨好的事情. 特别是觉得自己在这个公司/团队不会长待的时候, 新代码也不会尽心尽力地写好, 更别说把坏代码改好了…_

你需要说 "不"

> 尽管努力去寻找问题的解决方案十分重要, 但是在找不到方案的时候, 我期望你能够直接说 "不". 你需要意识到, **相比编码的能力, 你被聘用的原因更多是说 "不" 的能力.** 你, 作为一个程序员, 知道某件事情是否可能. …… 无论你面临多大的日程压力, 无论多少经理强烈要求结果, 当答案确实是 "不" 的时候, 我期望你能够说出 "不".

- _icehe : 标粗的这句话恐怕会产生一些争议. 不过我觉得作者想强调的是开发者心里要有 "B数", 明白一件事/需求/方案是否可行. 当然这个判断力来之不易, 需要技术人持续不断的学习, 以拓宽技术视野, 也要达到一定的技术深度._

客户权利详讨

> "客户有权制订总体计划, 并且知道完成的时间和成本."
>
> ……
>
> 计划要尽可能地确切和精准这句话经常让我们陷入麻烦, 因为能够做到既确切又精准的唯一方法就是实际去开发这个项目. 什么都没干是不可能做到既确切又精准的. 因此, 要想保证客户的这项权利, 程序员必须确保计划、估算以及日程都恰当地描述了不确定程度, 并且要定义出减少不确定性的手段.
>
> **简单来说, 我们无法同意在固定时间期限内交付固定的项目范围. 要么范围, 要么日期, 必须有一个是弹性的.** 我们利用概率曲线来表示这种弹性. 例如, 我们估算在截止日期前完成前 10 个故事的概率是 95% , 额外多完成 5 个故事的概率是 50% , 再多完成 5 个故事的概率是 5% .

开发人员权利详讨

> "开发人员有权保持高质量的工作输出"
>
> 这可能是所有权利中嘴强的一个. 开发人员有权做好工作. **业务人员无权要求开发人员走捷径或降低质量. 或者换句话说, 业务部门无权强迫开发人员破坏自己的职业声誉或者违反职业道德.**

- _icehe : 这个真的很不容易, 要是哪里允许, 那里就是技术人的 "理想乡". 业务/产品/运营优先的地方, 你不得不满足 "能用就行, 赶紧上线" 的要求._

> "开发人员有权决定是否承接某种职责, 而不接受指派."
>
> 专业人士承接工作, 而非被指派工作. 专业开发人员有权针对某个具体工作或任务说 "不" . 拒绝任务可能是因为开发人员对自己完成任务的能力没有信息, 或者他们认为该任务更适合其他人, 又或者有个人或到的方面的原因.
>
> ( 想想大众汽车公司的开发人员, 他们 "接受" 了在加州欺骗 EPA 试验台的任务 ( 识别汽车是否处于被检测状态，继而调控所排放的尾气 )

- _icehe : 在一般公司里这么干, 恐怕会被解雇…_

### 第三章 业务实践

三元分析

> 一种非常适合用于大型任务的技术是 **三元估算**. 这种估算由 3 个数组成, 这 3 个数分别对应 最佳情况、正常情况和最坏情况.
>
> 这些都是对信心的估计 : 最差情况是指你有 95% 的信心认为能完成该任务的时间, 正常情况仅具有 50% 的信心, 最佳情况仅具有 5% 的信心.
>
> _例如, 我有 95% 的把我在 3 周内完成该任务, 50% 的抱我在 2 周内完成, 5% 的把握在 1 周内完成._

故事

> 用户故事是软件功能的简单描述, 以备将来查阅. **写故事时尽量不要记录太多细节, 因为我们知道这些细节很有可能会改变**. 细节随后还是会被记录下来, 不过是以 **验收测试** 的形式
>
> 故事遵循一组简单的指导原则, 这组原则的首字母缩写是 **INVEST**.
>
> - **I : Independent 独立.** 用户故事之间互相独立. 这意味着在实现它们时不必遵循特定的顺序. _例如登录不是必须在退出之前实现._
> - **N : Negotiable 可协商.** 这是我们不在卡片上写下所有细节的另一个原因 : 我们希望开发人员和业务人员之间可以就这些细节进行协商.
> - **V : Valuable 有价值.** 用户故事必须对业务具有明确且可量化的价值.
>     - **重构永远不可能是故事. 架构设计永远不可能是故事. 代码清理也永远不可能是故事. 故事永远是有业务价值的东西.** _不用担心, 我们会处理重构、架构设计和代码清理的事情, 但不会以故事的形式._
> - **E : Estimable 可估算.** 用户故事必须足够具体, 以允许开发人员进行估算.
>     - 诸如 "系统必须快" 之类 的故事是无法估算的, 因为它没完没了 : 性能要求是所有故事背后都必须实现的需求.
> - **S : Samll 小.** 用户故事不应大于一到两个开发人员可以在一个迭代中实现的工作量.
>     - 不希望这个团队整个迭代就做一个故事. 一个迭代包含的故事数量应该与团队中开发人员的数量大致相当 : 如果团队有 8 个开发人员, 则每个迭代应包含大约 6 到 12 个故事.
> - **T : Testable 可测试.** 业务部门应该能够提出用户故事的测试标准, 通过这些测试就能表明用户故事已经完成.

对迭代进行管理

> **QA 与验收测试**
>
> "完成" 的定义就是 : 验收测试通过.
>
> **我们追求的不是速度快, 而是要取得具体、可度量的进展**, 要取得可靠的数据.

速率

> 迭代的最后一步是更新速率图和燃尽图. …… 经过几次迭代后, 这两张图都将开始呈现出一条斜线. 燃尽斜线可以用于预测下一个主要里程碑的日期, 速率斜线则告诉我们团队管理得如何.
>
> ……
>
> 我们期望在最初的几个迭代之后, 速率斜线的斜率将变成零, 也就是速率斜线主键趋向水平. **长期来看, 我们不希望团队加速或放缓.**
>
> **速率上升**
>
> 如果我们看到速率斜线呈现正的斜率, 未必表示团队正在更快地前进也可能是因为项目经理正在向团队施加压力, 要求其加快开发速度. 随着压力的增加, 团队会在不知道不觉中改变估算值, 使得项目从数据上开起来前进得更快.
>
> 这就是简单的通过膨胀. 故事点就是一种货币, 团队正在外部压力下令其贬值. 明年你再回来看看这个团队, 他们每次迭代恐怕能完成数百万故事点. 这里的教训是, 速率是 "度量" 而不是 "目标". 这是控制论基础 : 不要给度量对象施加压力.
>
> 在 IPM 中估计迭代的容量只是为了让利益相关者的值可能完成多少故事, 这有助于利益相关者选择故事和做计划. _但这个估计值不是承诺, 即使实际速率较低, 团队也并非失败._

### 第四章 团队实践

隐喻

> "隐喻" 的概念是这样的 : 为了有效地进行沟通, 团队需要一个受限制的、有纪律的词汇表, 其中包含项目中的术语及概念. 肯特·贝克之所以称其为隐喻, 是因为它能将项目与团队具备的共同知识关联到一起.

领域驱动设计

> 统一语言 Ubiquitous Language 一词, 才是 "隐喻" 实践该有的名字

可持续节奏

> 20 世纪 70 年代初期, 我年仅 18 岁, 和高中伙伴一起, 受聘为某个 "极度重要的" 项目的程序员. 我们的 "经理" 设定了 "截止日期" . 截止日期是 "绝对不能变" 的. 我们的努力"很重要" ! 如果说组织是台机器的话, 我们就是其中的关键齿轮. 我们很重要
>
> 18 岁很美好, 不是吗?
>
> 作为刚从高中毕业的年轻人, 我们马力全开. 我们夜以继日地工作了好几个月, 每周平均工作超过 60 小时, 有几个星秀场甚至达到 80 小时以上. 我们甚至干了几十个通宵!
>
> 我们为所有的加班 "感到自豪" ! 我们是 "真正的程序员" ! 我们 "全力投入" ! 我们 "有价值" ! 因为我们一手 "拯救" 了一个重要的项目, 我们! 是! 程序员!
>
> 然后, 我们筋疲力竭 —— 太辛苦了. 辛苦到 "集体辞职" 了. 我们骤然里去, 公司只留下了一个几乎无法工作的分时系统, 没有任何有能力的程序员来支持它. "走着瞧" !
>
> 愤怒的 18 岁很美好, 不是吗?
>
> 别担心, 公司渡过了困境. 事实证明我们并不是唯一可以胜任的程序员. 哪里有一批人每周认真地工作 40 小时. 在私密的编程狂欢夜中, 我们鄙视那些既不投入又懒惰的人. 然而正是这些人悄悄地收拾好烂摊子, 并维持系统正常运行. 我敢说, 他们很高兴摆脱我们这些愤怒、吵闹的孩子.

加班

> 你可能以为我从那次经验中学到了教训. 显然, 并没有. 在接下来的 20 年中, 我继续为雇主加班工作, 也继续被 "重要项目" 诱惑. ……
>
> 随着长大并逐渐成熟, 我意识到自己最糟糕的技术错误都是在狂热熬夜时犯下的. 我意识到, 那些错误给工作造成了巨大的阻碍, 然后我在清醒时又不得不想办法绕开它们.

马拉松

> 那一刻, 我学到了软件项目是一场马拉松, 不是冲刺, 更不是一系列连续冲刺. 为了获胜, 你必须均匀配速. 如果你全速越过障碍物奔跑, 那么在抵达终点之前就将耗尽力气.
>
> 因此, **你的奔跑步伐必须能长时间维持. 你必须以 "可持续节奏" 来奔跑. 如果尝试以超过自己可持续的速度奔跑, 那么就必须减速和休息才能到达终点, 这样一来, 你的平均速度将慢于 "可持续节奏". 当接近终点线时, 如果还剩有能量, 你可以冲刺. 但是在那之前不能冲刺.**
>
> **经理可能会要求你比配速跑得再快点儿. 你一定不能遵从这样的想法. 你有义务节约自己的资源以确保坚持到最后.**

- _icehe : 长久的职业生涯和日常生活也是一样的吧? 需要张弛有度, 保证坚持到 "人生" 最后._

奉献精神

> **加班工作并不能向雇主展现你的风险精神. 这只能表明你的计划做的糟糕, 你答应了不该答应的截止日期, 承诺了不该承诺的事情, 你只是一个可被操纵的劳工而非专业人士.**

- _icehe : 不想再被 "价值观" PUA 了._

> 这并不是说所有的加班都是坏事, 也不是说永远都不要加班. 某些情况下的确只能加班, 但它们不应该成为常态. 而且你必须非常 "清醒地意识到" **加班的成本可能远远超过省下的时间.**
>

- _icehe : 感受到一些经理就是觉得底下的程序员就是一堆 "码农" 而已, 分派的都是些 "搬砖" 一类简单可重复的任务, 而不是繁重的脑力劳动, 所以可以随意操纵员工完成任务. 虽然他们可能不那么说, 甚至他们的理性也不这么想, 但神奇的是他们实际上习惯性地那么做…_
    - _"**加班的成本可能远远超过省下的时间.**" 没错, 不少熟练有经验的高级工程师, 被所谓的 "重要项目" 的连续不断的高强度加班逼得跳槽, 甚至宁可裸辞 ( True Story ) ._
    - _就这样, 一个好不容易经过两三年招人组建的小团队, 事实上崩了 —— 一个 "重要项目" 长期损害了一些稳定团队/部门的长期利益, 以至于将其摧毁, 导致这些团队/部门从领导到基层工程师对公司离心离德._

睡觉

> **程序员最宝贵的养生之道就是充足的睡眠.** 我一天睡 7 小时就够了, 偶尔有一两天只睡 6 小时也可能承受. 再减少睡眠的话, 我的生产力就会直线下降. 充分了解你自己的身体需要多少小时的睡眠, 然后留出足够的时间, 这些时间将会加倍回报你. **我的经验法则是, 少睡 1 小时会废掉白天的 2 小时的工作时间, 少睡 2 小时会废掉 4 小时的生产力. 显然如果少睡 3 小时, 那就根本不会有任何产出.**

- _icehe : 不能同意更多! 早睡早起, 把最重要的事情放在早上做, 真的感觉很棒! "要事第一" 的原则, 我最近终于做到了, 希望再接再厉!_

代码集体所有

> _"代码集体所有" 并非说你不能有所专长. 随着系统复杂性的增长,专业化绝对有必要. 有些系统如此庞大, 任何个人都不可能既完整又详细地全面理解它. 但是, 即使你有所专长, 同事也必须是通才. 你既要在自己专长的领域工作, 又要与其他领域的代码打交道. 你要保持在专长领域之外工作的能力._
>
> 当团队采用 "代码集体所有" 时, 知识就会分散在团队中. 每个退队成员都能够更好地理解模块之间的界限, 以及系统的整体工作方式. 这极大地提高了团队沟通和决策的能力.
>
> 在我相对较长的职业生涯中, 我见过一些与 "代码集体所有" 背道而驰的公司. 每个程序员都独占自己的模块, 其他人不可以触碰. 这种技能严重失调的团队经常陷入互相指责和无效沟通中. 如果一个模块的作者没有来工作, 进展就会陷入停滞. 没有人敢碰别人占有的东西.

- _icehe : 有时负责别的服务的同事说我的接口行为有误, 我怎么找都找不着 bug; 后来只能 review 和测试提出问题的那个同事的项目代码, 才找到原因, bug 就在他那里…_

## 读者跋

- icehe : 有冲动想用 "敏捷" 的方式来管理个人生活.
    - 不过欲速则不达, 根据个人实际来完成任务吧!
