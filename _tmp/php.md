# PHP 编程经验

> 写 PHP 代码的一些经验与感想。

---

## 引子

有太多的编程语言和工具，一旦不常使用，很容易就会遗忘其中一些需要重视的细节。所以，有必要去总结、固化自己掌握的相关知识经验。即使一时忘记了也不要紧，用自己的总结材料来复习，可以快速地「重拾」曾经掌握过的技能。

笔者水平有限，请谨慎参考本文。可以去 Google，甚至看源码。尽量自己动手写代码，来对具体的情况进行试验，因为文档可能会过时失效，记忆可能会模糊出错，只有用实践来检验真理才是最牢靠的。如发现本文的错误，烦请指正，感谢交流~

### 八卦：最好的语言？

> PHP 是世界上最好的（编程）语言！
>
> __原始出处不详__

不少 PHP 的圈外人和新手不懂行，难免无法理解以至于误解这句流传甚广的话，甚至睥睨 PHP 并施以冷嘲热讽。

（如果一个程序员对计算机的技术和文化有足够的理解，应该耻于做这种「忽视场景，牵强对比各种编程语言优劣」的事来自找优越感。除非是一些特别的情况，可能他在「钓鱼」或者…… 见下文）

实际上「PHP 是世界上最好的语言」这句话已经成了一种梗，PHP 程序员经常以这种「自嘲」的方式表明身份。比如，我们也会戏称自己以「拍黄片」（Pai Huang Pian）为业。

- PHP 圈的八卦见闻：
    竟然有人嘲笑 PHP 的「继父」鸟哥 惠新宸（Laruence [@weibo](http://weibo.com/laruence)、[@GitHub](https://github.com/laruence)、[@Blog](http://www.laruence.com/)）竟然敢自称「亚洲第一程序员」（我真实碰过这么认为的朋友），其实这是一个以讹传讹的失实说法。鸟哥并没有这样自称，「亚一程」这只不过是中国 PHP 小圈子里的友人给他取得的一个绰号而已，是一个富于幽默感的戏称（爱称），也算是由「PHP 是最好的语言」引申出来的梗。毕竟鸟哥给 PHP 社区做出了如此巨大的贡献，旧的 PHP 项目只要换上 PHP7 的运行环境就能有惊人的性能提升（可另行搜索了解详情），然后当年的性能 KPI 就完成了…… 圈内用这样饶有趣味地方式来捧鸟哥，实在是再正常不过的事，哈哈。PHP7 出来已经挺久，现在也不常有人提起「亚一程」这个梗了。

### PHP 的一些槽点

但是不得不承认，PHP 在诞生之初，由于一些缺乏远见的初始设计，导致了它有着一些难以修正的缺陷，但无伤大雅。在完美主义者的眼里，PHP 确实写起来不够「优雅」。为了兼容性，即使是焕然一新的新版本 PHP7，也无法抛弃全部的历史包袱。这里提其中一些槽点：

1. __美元符 `$`__ 通常放在变量名前面，用于声明和使用变量，有人光是看到 `$` 美元符就会觉得特不爽。
2. 内建函数的 __函数名__ 风格不一致、或长或短，其中一些函数明显带有 C 语言的风格特征，其实就和 C 语言的库函数同名，然而后来新增的一些内建函数的名字却又比较完整比较长……
3. 不少函数的 __函数参数__ 的排列规律不够一致（可准确预测），如果不常用、又不去参考手册（[PHP.net](http://php.net/)），我会担心自己搞错它们含义、用途和排列顺序。
    - 官方网站 [PHP.net](http://php.net/) 也是一个奇特的存在，它是存放参考文档的网页，也像一个论坛或问答区（官网并没有直接提供社区）。参考页面下可以盖楼「评论」，你可以对评论「顶」或「踩」，许多评论会提供相关的使用样例、测试代码和更深入的细节说明，可能比文档正文还管用……
4. __函数的返回值__，跟 C 语言一样，它的返回值并不一致。
    - 例如，C 语言的一些关于字符数组的库函数，它们的返回类型是 int，因为 C 不可能依靠抛出异常来表示错误，只能给 int -1 这种值额外赋予特殊的含义，即发生错误，所以表达上并不够清晰和一致（其实这并无大碍，毕竟它是比较接近硬件的机器码，不可能也没必要封装异常这种「高级特性」）。
    - PHP 是一种弱类型的语言，虽然也有「类」和「异常」，但是使用一些内建函数也并不抛出异常。例如 `strpos()`，它会返回字符串中的某种子字符串的出现位置，这个位置由非负的整数来表示，如果找不到就会返回布尔类型的 `false`。
    - 这时如果要判断「某个子字符串没在一个字符串里出现」就得用表达式：
        `false !== strpos('字符串', '子字符串')`。
        - 基础说明：`!==` 是「不全等于」的比较操作符，比较的两个变量的数值及其类型要同时不一样时，表达式的结果才是 `true`；`!=` 是「不等于」的比较操作符，只要比较的两个变量的数值相等，表达式结果就是 `true`，如果它们的数值类型不同，就会对变量进行隐式的类型转换，然后再进行比较。正是因为弱类型语言的这一「隐式类型转换」的过程，许多对编程语言不熟悉、逻辑又不严谨的程序员，写出了 bug 频出的 PHP 代码。
        - 如果这时误用了逻辑表达式 `false != strpos('字符串', '子字符串')` 来判断可就麻烦了：
            子字符串出现在字符串的开头，`strpos()` 会返回整数 `0`，
            然后 `0` 会转换成 `boolean` 布尔类型，值为 `false`，最终表达式同样也会返回 `true`，然而这是错误的判断结果。它跟 C 语言中的 `strpos()` 有着「异曲同工之错」，容易被不熟练的人误用。
5. __弱类型变量的比较__，详见上一段。「隐式类型转换」是弱类型编程语言的特点，是优点也是缺点 —— 容易上手，但更容易用错。在后文的「逻辑表达式」小节，会有更进一步的细节讨论。
6. 其它暂略……

__知乎问答[「PHP既然这么烂，那它是怎么火起来的？」PHP7 核心开发者 惠新宸 Laruence 的回答](https://www.zhihu.com/question/28596521/answer/49125835)__ 值得一看。
